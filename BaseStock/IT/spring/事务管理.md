JdbcTemplate

事务管理

  

平台事务管理器

PlatformTransactionManager接口 spring的事务管理器

方法:

TransactionStatus --返回值为状态码

1.getTransaction(TransactionDefination defination)

获取事务的状态信息,同时开启事务管理

  

2.void commit(TransactionStatus status) 提交事务

3.void rollback((TransactionStatus status)回滚事务

  

平台事务管理器,是因为平台不一样事务管理器就不一样

例如:Dao层技术是jdbc或者Mybatis时 使用

DataSourceTransactionManager

是hibernate时使用HibernateTransactionManger

这两个都是实现了PlatformTransactionManager

  

需要告诉spring框架使用的哪个平台使用那个事务管理器

通过配置的方法

  

事务定义对象

TransactionDefinition

方法:

int gfetIsolationLevel() 获取事务的隔离级别

int getPropogationBehavior() 获取事务的传播行为

int getTimeout() 获得超时时间

boolean isReadOnly() 是否只读

  

事务传播行为

事务的传播行为,是因为当A事务在处理的时候调用了B事务,那么到底以哪个为标准,这就是事务的传播行为

REQUIRED 如果当前没有事务就创建一个事务 如果已经存在一个事务中,一般的选择(默认值)

SUPPORTS:支持当前事务,如果当前没有事务,就以非事务方式执行(没有事务)

![](C:\Users\YuLi\AppData\Local\YNote\data\qq3AE958F571E4572DE9CC711939D04018\da42ca119f494477b28d1d4e8d11561b\7f26e96bc1b44b62b29963ac3be2aed4.jpg)

事务状态对象

TransactionStatus 接口 题库功德是事务具体的运行状态

检测,是否存储回复你点

事务是否完成

是否是新事物

事务是否回滚

状态对象不需要我们主动设置,因为他是被动从产生的

  

编程式事务控制三大对象

PlatformTransactionManager 事务管理器

TransactionDefinition 事务定义

TransactionStatus 事务状态

  

基于XML的声明式事务控制

tx方法

Spring声明式事务控制 采用声明的方式来处理事务

控制底层就是AOP

  

谁是切点:需要被增强的转账方法

谁是通知:事务管理方法就是通知

配置切面:

  

tx-advice是配置通知的 id名 事务管理器 然后在其中引入对应平台事务管理器

然后再<aop-config>中<aop-advisor ref-....id名

  

基于注解的事务控制方法

<!--开启事务注解-->

<tx:annotation-driven transaction-manager="transactionManager"></tx:annotation-driven>

  

注解书写方法 可以在方法或者类上书写

@Transactional(propagation = Propagation.REQUIRED,

isolation = Isolation.REPEATABLE_READ ,readOnly = false)

  

  

编程式事务管理基本步骤:

1.在Spring.xml文件中配置好context和aop

2.<context:component-scan base-package="com.YL">

</context:component-scan> 配置注解编译扫描路劲

3.创建好基本的Dao层和操作

  

并创建一个SelfTransactionManager

设置其中的开启事务 提交事务 和回滚事务

![](C:\Users\YuLi\AppData\Local\YNote\data\qq3AE958F571E4572DE9CC711939D04018\08fab18d3fc242a09913847a0d76f1f0\f137964407b44fdb9e289c358398e9d1.jpg)

4.通过context property-olaceholder来加载c3p0配置文件

5.ioc jdbcTeplate 并配置属性datasource

6.配置datasource driverClass等,通过引用上面的c3p0文件

7.ioc DataSourceTransactionManager

并且配置datasource 引用上面的datasource

保证是同一个链接池

8.在userService中 DI注入SelfTransactionManager

调用SelfTransactionManager的开始事务和回滚等,进行具体事务管理

  

  

  

优化版:

将在UserServiceImpl中的事务管理操作

变成AOP切入操作 将事务管理变成around通知

然后在对应节点切入

![](C:\Users\YuLi\AppData\Local\YNote\data\qq3AE958F571E4572DE9CC711939D04018\7b3acfcffbbe490cb5b1248e74e395fa\2208b99e6ffb4d20aba082b3162a30bc.jpg)

  

具体切入那些方法,可以在Spring.xml中配置

  

![](C:\Users\YuLi\AppData\Local\YNote\data\qq3AE958F571E4572DE9CC711939D04018\6ecf14506cd44a23af840ea0866404d8\7b8775addfcf48e3a22f8b5a4098429e.jpg)

  

最终注解优化版

<!-- 事务管理方法3-->

<tx:annotation-driven transaction-manager="transactionManager"></tx:annotation-driven>

  

在xml文件中配置开启注解事务管理

@Transactional(propagation = Propagation.REQUIRED,isolation = Isolation.REPEATABLE_READ)

  

使用注解进行事务管理

可以写在对应类或者方法上

当类和方法上都有时候,方法的将会覆盖类的